<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
xmlns:h="http://java.sun.com/jsf/html"
xmlns:f="http://java.sun.com/jsf/core"
xmlns:ui="http://java.sun.com/jsf/facelets"
xmlns:p="http://primefaces.org/ui"
xmlns:c="http://java.sun.com/jsp/jstl/core"
	>

<h:head>
    <title>Main page</title>
</h:head>
<h:body>
	 <h:outputStylesheet library="css" name="bootstrap.css" />
	 <h:outputStylesheet library="css" name="todo.css" />
     <h:outputScript library="js" name="bootstrap.js" />

	<nav class="navbar navbar-dark bg-dark">
		<div class="ui-g-6">
		 <a class="navbar-brand" style="float: left" title="To homepage" href="./pages/login.xhtml">TODO</a>
		 <h:form styleClass="form-inline" style="float: left;">
		 	<p:commandButton icon="pi pi-check" action="#{taskView.prepareNewTask}" style="top: 3px;" styleClass="align-middle" title="Create new task" onclick="PF('dialog').show();"></p:commandButton>
		 </h:form>
		</div>
		
	<div class="ui-g-6">
		<h:form class="ui-g-9">
		<p:commandButton icon="pi pi-check" style="float: right;" title="Send" actionListener="#{authorizedUserView.sendInvitation}" />		
 		<p:autoComplete id="findUsers" style="float: right;" placeholder="Find a friend" value="#{authorizedUserView.requestFriend}" var="friend" itemLabel="#{friend.name} #{friend.surname}" itemValue="#{friend}" converter="#{userConverter}" completeMethod="#{authorizedUserView.findUsers}" />
 
		</h:form>
		<div class="ui-g-3">
		<div class="dropdown">
	
		  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		     	<h:form>
					<h:outputText id="username" value="#{authorizedUserView.currentUser.email}"/>
				</h:form>
		  </button>
		  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
		    <h:outputLink styleClass="dropdown-item" value="#{request.contextPath.concat('/logout')}"  >
				<h:outputText value="Logout"  />
			</h:outputLink>
		  </div>
		</div>
		</div>
	</div>
	</nav>	
	<h:form id="friendRequests" >
			<p:dataTable id="requests" var="rq" value="#{authorizedUserView.requests}">
				<p:column headerText="Uživatel">
					<ui:repeat var="user" value="#{authorizedUserView.requestedUsers(rq)}">
							<h:outputText value="#{user.displayName}" />
					</ui:repeat>
				</p:column>
				<p:column style="width:45px">
					<p:commandButton icon="pi pi-check" action="#{authorizedUserView.acceptRequest(rq)}" style="width: 100%; height: 100%;" update="@form" />
				</p:column>
				<p:column style="width:45px">
					<p:commandButton icon="pi pi-ban" action="#{authorizedUserView.denyRequest(rq)}" style="width: 100%; height: 100%;" update="@form"  />
				</p:column>
			</p:dataTable>
	</h:form>
	
	<h:form id="taskForm">
		<p:dataTable id="tasksTbl" var="tsk" value="#{authorizedUserView.tasks}">
		    <p:column headerText="Priorita"  sortBy="#{tsk.priority}" styleClass="#{tsk.color}">
		        <h:outputText  value="#{tsk.priority}" />
		    </p:column>
		 
		    <p:column headerText="Název">
                <h:outputText value="#{tsk.name}" />
		    </p:column>
		 
		    <p:column headerText="Plán">
		        <h:outputText value="#{tsk.getPlannedTime()}" />
		    </p:column> 
		 
		    <p:column headerText="Skutečnost">
		        <h:outputText value="#{tsk.getRealTime()}" />
		    </p:column>
		    
		    <p:column style="width:45px">
				<p:commandButton icon="pi pi-pencil" action="#{taskView.updateTask(tsk)}" style="width: 100%; height: 100%;" update=":dialog" oncomplete="PF('dialog').show()" />
        	</p:column>
        	<p:column style="width:45px">
        	     <p:commandButton icon="pi pi-trash" style="background-color: red !important; border-color: red !important; width: 100%; height: 100%;"  action="#{taskView.deleteTask(tsk.id)}" >
            		<p:ajax event="click" listener="#{taskView.refresh}" />
            	</p:commandButton>
        	</p:column>
		</p:dataTable>

		</h:form>
		
		<p:dialog id="dialog" widgetVar="dialog" modal="true" style="width: 200px;">
		<h:form>
		<p:panelGrid id="grid" columns="2">
			<h:outputLabel for="newTaskPrio" value="Priorita" />
			<p:selectOneMenu id="newTplusaskPrio" style="width: 100%" value="#{taskView.newTask.priority}" >
				<f:selectItems value="#{taskView.priorityEnums}" />
			</p:selectOneMenu>
			
			<h:outputLabel for="newTaskName" value="Název" />
			<p:inputText id="newTaskName" value="#{taskView.newTask.name}" />
		
			<h:outputLabel for="newTaskGuess" value="Čas od" />
			<p:calendar id="newTaskGuess" value="#{taskView.newTask.from}" pattern="MM/dd/yyyy HH:mm:ss" />

			<h:outputLabel for="newTaskReal" value="Čas do" rendered="#{taskView.toUpdate}"/>
			<p:calendar id="newTaskReal" value="#{taskView.newTask.to}" rendered="#{taskView.toUpdate}" pattern="MM/dd/yyyy HH:mm:ss" />
			
			<h:outputLabel for="assignee"  value="Osoba"  rendered="#{taskView.toUpdate}" />
			<p:selectOneMenu id="assignee" value="#{taskView.newTask.user}" converter="#{userConverter}" rendered="#{taskView.toUpdate}">
				<f:selectItems value="#{authorizedUserView.users}"  var="theme" itemLabel="#{theme.name}" itemValue="#{theme}"  />
			</p:selectOneMenu>	
			
			<p:commandButton icon="pi pi-refresh" actionListener="#{taskView.stopTheClock()}" onclick="PF('dialog').hide()" value="Stop" update=":taskForm">
			</p:commandButton>
						
			<p:commandButton icon="pi pi-save" style="float: right" actionListener="#{taskView.saveTask}" onclick="PF('dialog').hide()" value="Uložit" update=":taskForm">
			</p:commandButton>
		</p:panelGrid>
		</h:form>
	</p:dialog>
</h:body>
</html>
